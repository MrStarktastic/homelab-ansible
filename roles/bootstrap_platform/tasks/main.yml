- name: Configure Kube-Vip service ranges
  kubernetes.core.k8s:
    namespace: kube-system
    definition:
      apiVersion: v1
      kind: ConfigMap
      metadata:
        name: kubevip
      data:
        cidr-global: "{{ vip_service_cidrs }}"

- name: Pre-seed sealed-secrets master key
  kubernetes.core.k8s:
    state: present
    definition:
      apiVersion: v1
      kind: Secret
      metadata:
        name: sealed-secrets-key-bootstrap
        namespace: kube-system
        labels:
          sealedsecrets.bitnami.com/sealed-secrets-key: active
      type: kubernetes.io/tls
      data:
        tls.key: "{{ sealed_secrets_key_b64 }}"
        tls.crt: "{{ sealed_secrets_crt_b64 }}"

- name: Setup ArgoCD
  ansible.builtin.include_tasks: argocd.yml
